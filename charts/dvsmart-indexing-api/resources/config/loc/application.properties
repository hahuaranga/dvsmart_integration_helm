# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================
spring.application.name=dvsmart-indexing-api
server.servlet.context-path=/dvsmart_indexing_api
server.port=8080
spring.main.allow-bean-definition-overriding=true

# ============================================================================
# MONGODB CONFIGURATION
# ============================================================================
spring.mongodb.uri=mongodb://dvsmart_user:eoQQqfTyMd@dvsmart-catalog-mongodb.dvsmart.svc.cluster.local:27017/dvsmart-ms?authSource=dvsmart-ms
#spring.mongodb.uri=mongodb://dvsmart_user:eoQQqfTyMd@localhost:30000/dvsmart-ms?authSource=dvsmart-ms

spring.batch.job.enabled=false

# ============================================================================
# BATCH CUSTOM PROPERTIES (BatchConfigProperties)
# ============================================================================
# Tamanio del chunk para procesamiento por lotes
# Cada chunk procesa este numero de registros antes de commit
batch.chunk-size=100

# Tamanio del pool de threads para procesamiento asincrono
# Mas threads = mas procesamiento paralelo (balance con recursos del servidor)
batch.thread-pool-size=20

# Capacidad de la cola de tareas pendientes
# Si hay mas tareas que threads, se encolan aqui
batch.queue-capacity=1000

batch.skip-limit=5

batch.retry-limit=3

# ============================================================================
# SFTP ORIGIN CONFIGURATION (SftpConfigProperties.Origin)
# ============================================================================
# Servidor SFTP de origen (donde estan los archivos actuales)
sftp.origin.host=dvsmart-source-filesystem-sftp.dvsmart.svc.cluster.local
#sftp.origin.host=localhost
sftp.origin.port=22
#sftp.origin.port=30002
sftp.origin.user=sftpsourceuser
sftp.origin.password=securepass

# Directorio base en el servidor origen
sftp.origin.base-dir=/disorganized_data

# Timeout de conexion en milisegundos (30 segundos)
sftp.origin.timeout=30000

# Tamanio del pool de conexiones SFTP origen
# Mas conexiones = mas operaciones simultaneas de lectura
sftp.origin.pool.size=10

# ============================================================================
# SFTP POOL CONFIGURATION (Lazy + Health Check)
# ============================================================================
# Pool lazy: no crear conexiones al inicio
sftp.origin.pool.lazy-init=true

# Tamanio inicial del pool (0 = completamente lazy)
sftp.origin.pool.initial-size=0

# Tamanio maximo del pool
sftp.origin.pool.max-size=10

# Tiempo maximo de espera por una conexion (ms)
sftp.origin.pool.max-wait-millis=30000

# Validar conexion antes de usarla
sftp.origin.pool.test-on-borrow=true

# Validar conexiones inactivas cada X ms
sftp.origin.pool.time-between-eviction-runs-millis=60000

# Tiempo maximo de inactividad antes de cerrar conexion (ms)
# 5 minutos (menor que el timeout del servidor de 10 min)
sftp.origin.pool.min-evictable-idle-time-millis=300000

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
# Nivel de log general
logging.level.root=INFO

# Logs de la aplicacion (ajustar segun necesidad)
logging.level.com.indra.minsait.dvsmart.indexing=DEBUG

# Logs de Spring Batch (INFO para produccion, DEBUG para desarrollo)
logging.level.org.springframework.batch=INFO

# Logs de Spring Integration SFTP (DEBUG para troubleshooting)
logging.level.org.springframework.integration.sftp=DEBUG

# Logs de MongoDB
logging.level.org.springframework.data.mongodb=INFO

# Patron de log para consola
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg%n

# Logging especifico para ShedLock
logging.level.net.javacrumbs.shedlock=DEBUG

# ============================================================================
# ACTUATOR CONFIGURATION (Monitoring & Health)
# ============================================================================
# Exponer endpoints de actuator
management.endpoints.web.exposure.include=health,info,metrics,batch

# Mostrar detalles del health check
management.endpoint.health.show-details=always

# Habilitar metricas de JVM, proceso y sistema
management.metrics.enable.jvm=true
management.metrics.enable.process=true
management.metrics.enable.system=true