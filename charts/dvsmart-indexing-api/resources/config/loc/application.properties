# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================
spring.application.name=dvsmart-indexing-api
server.servlet.context-path=/dvsmart_indexing_api
server.port=8080

# ============================================================================
# MONGODB CONFIGURATION
# ============================================================================
spring.mongodb.uri=mongodb://dvsmart_user:eoQQqfTyMd@dvsmart-catalog-mongodb.dvsmart.svc.cluster.local:27017/dvsmart-ms?authSource=dvsmart-ms
#spring.mongodb.uri=mongodb://dvsmart_user:eoQQqfTyMd@localhost:30000/dvsmart-ms?authSource=dvsmart-ms


# ============================================================================
# H2 DATABASE CONFIGURATION (Spring Batch Metadata)
# ============================================================================

# URL de H2 (in-memory, se reinicia con la aplicación)
spring.datasource.url=jdbc:h2:mem:batchdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE

# Driver de H2
spring.datasource.driver-class-name=org.h2.Driver

# Credenciales (por defecto H2 no requiere password)
spring.datasource.username=sa
spring.datasource.password=

# Configuración del pool de conexiones
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2

# ============================================================================
# H2 CONSOLE (Opcional - Para debugging)
# ============================================================================

# Habilitar consola web de H2
spring.h2.console.enabled=true

# Path de la consola H2
spring.h2.console.path=/h2-console

# Permitir acceso remoto (solo desarrollo)
spring.h2.console.settings.web-allow-others=false

# ============================================================================
# SPRING BATCH SCHEMA INITIALIZATION
# ============================================================================

# Inicializar schema de Spring Batch automáticamente
spring.batch.jdbc.initialize-schema=always

# Alternativas:
# - always: Siempre crea las tablas (borra y recrea)
# - embedded: Solo si es base de datos embebida (H2, HSQL, Derby)
# - never: Nunca inicializa (debes crear tablas manualmente)

# ============================================================================
# JPA/HIBERNATE CONFIGURATION (Si usas JPA para otras cosas)
# ============================================================================

# Deshabilitar auto DDL de Hibernate (Spring Batch maneja su schema)
spring.jpa.hibernate.ddl-auto=none

# Mostrar SQL en logs (opcional, útil para debugging)
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true

# Dialecto de H2
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect



# ============================================================================
# BATCH CUSTOM PROPERTIES (BatchConfigProperties)
# ============================================================================
# Tamanio del chunk para procesamiento por lotes
# Cada chunk procesa este numero de registros antes de commit
batch.chunk-size=100

# Limite de concurrencia (deprecado, usar thread-pool-size)
batch.concurrency-limit=10

# Tamanio del pool de threads para procesamiento asincrono
# Mas threads = mas procesamiento paralelo (balance con recursos del servidor)
batch.thread-pool-size=20

# Capacidad de la cola de tareas pendientes
# Si hay mas tareas que threads, se encolan aqui
batch.queue-capacity=1000

# ============================================================================
# SFTP ORIGIN CONFIGURATION (SftpConfigProperties.Origin)
# ============================================================================
# Servidor SFTP de origen (donde estan los archivos actuales)
sftp.origin.host=dvsmart-source-filesystem-sftp.dvsmart.svc.cluster.local
sftp.origin.port=22
sftp.origin.user=sftpsourceuser
sftp.origin.password=securepass

# Directorio base en el servidor origen
sftp.origin.base-dir=/disorganized_data

# Timeout de conexion en milisegundos (30 segundos)
sftp.origin.timeout=30000

# Tamanio del pool de conexiones SFTP origen
# Mas conexiones = mas operaciones simultaneas de lectura
sftp.origin.pool.size=10

# ============================================================================
# SFTP POOL CONFIGURATION (Lazy + Health Check)
# ============================================================================
# Pool lazy: no crear conexiones al inicio
sftp.origin.pool.lazy-init=true

# Tamanio inicial del pool (0 = completamente lazy)
sftp.origin.pool.initial-size=0

# Tamanio maximo del pool
sftp.origin.pool.max-size=10

# Tiempo maximo de espera por una conexion (ms)
sftp.origin.pool.max-wait-millis=30000

# Validar conexion antes de usarla
sftp.origin.pool.test-on-borrow=true

# Validar conexiones inactivas cada X ms
sftp.origin.pool.time-between-eviction-runs-millis=60000

# Tiempo maximo de inactividad antes de cerrar conexion (ms)
# 5 minutos (menor que el timeout del servidor de 10 min)
sftp.origin.pool.min-evictable-idle-time-millis=300000

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
# Nivel de log general
logging.level.root=INFO

# Logs de la aplicacion (ajustar segun necesidad)
logging.level.com.indra.minsait.dvsmart.indexing=DEBUG

# Logs de Spring Batch (INFO para produccion, DEBUG para desarrollo)
logging.level.org.springframework.batch=INFO

# Logs de Spring Integration SFTP (DEBUG para troubleshooting)
logging.level.org.springframework.integration.sftp=DEBUG

# Logs de MongoDB
logging.level.org.springframework.data.mongodb=INFO

# Patron de log para consola
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg%n

# Logging especifico para ShedLock
logging.level.net.javacrumbs.shedlock=DEBUG

# ============================================================================
# ACTUATOR CONFIGURATION (Monitoring & Health)
# ============================================================================
# Exponer endpoints de actuator
management.endpoints.web.exposure.include=health,info,metrics,batch

# Mostrar detalles del health check
management.endpoint.health.show-details=always

# Habilitar metricas de JVM, proceso y sistema
management.metrics.enable.jvm=true
management.metrics.enable.process=true
management.metrics.enable.system=true